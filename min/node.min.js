"use strict";(t=>{const r="object",e="each",s="if",i="{%",n="%}",h="",u=".",o={t:"key",r:"value",e:"pos",s:"even"};class l{constructor(t){this.i=t,this.n=t.split(u)}find(t){let r=t;for(let t of this.n){if(void 0===r[t])return h;r=r[t]}return r}h(t){return 1===this.n.length?t[this.i]:(void 0===t.u[this.i]&&(t.u[this.i]=this.find(t)),t.u[this.i])}}class c extends l{constructor(t,r){let e="!"===t.charAt(0);super(e?t.substr(1):t),this.o=r,this.l=e}render(t){return!!this.h(t)===this.l?h:this.o.render(t)}}class f extends l{constructor(t,r){super(t),this.o=r,this.c=t,this.f="_"+t.replace(u,"#")}a(t){let r=new Array(t.length);for(let e=t.length-1;e>=0;e--)r[e]=this.d(t[e]);return r}w(t){let r={};for(let e in t)r[e]=this.d(t[e]);return r}d(t){return typeof t!==r||null===t?t:t.constructor===Array?this.a(t):this.w(t)}p(t,r,e,s){let i={};i[o.t]=e,i[o.r]=r[e],i[o.e]=s,i[o.s]=!(s%2);for(let r in o)t.u[this.f+u+r]=i[r];return t[this.f]=i,this.o.render(t)}render(t){let e=this.h(t);if(!e)return h;if(typeof e!==r)return h;let s=[e,this.d(t),h];return e.constructor===Array&&this.y(...s),this.v(...s)}y(t,r,e){for(let s=0;s<t.length;s++)e+=this.p(r,t,s,s);return e}v(t,r,e){let s=0;for(let i in t)e+=this.p(r,t,i,s),s++;return e}}class a extends l{x(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return"&#039;"}}render(t){return(this.h(t)+h).replace(/[&<"'>]/g,this.x)}}class d{constructor(t){this.A=t}render(t){return this.A}}class w{constructor(t){this.g=this.m(t)}m(t){if(!t||"string"!=typeof t)return[];let r=[],e=-1;for(;(e=t.indexOf("{{"))>-1;){e>0&&(r.push(new d(t.substr(0,e))),t=t.substr(e));let s=t.indexOf("}}"),i=t.substr(2,s-2);t=t.substr(s+2),r.push(new a(i))}return r.push(new d(t)),r}render(t){let r=h;for(let e of this.g)r+=e.render(t);return r}}class p{constructor(t){this.g=[];let r=0;for(;(r=t.indexOf(i))>-1;){r>0&&this.g.push(new w(t.substring(0,r)));let e=(t=t.substring(r+2)).indexOf(n),s=t.substring(0,e).split(" "),i=this.b(t,e+2);this.k(s[0],s[1],new p(t.substring(e+2,i))),t=t.substring(i+7)}this.g.push(new w(t))}k(t,r,i){if(t===e)return this.g.push(new f(r,i));if(t===s)return this.g.push(new c(r,i));throw new Error("Token "+t+" is invalid.")}T(t){return t===e||t===s?1:-1}b(t,r){let e=r,s=1;for(;(r=t.indexOf(i,e))>-1;){e=t.indexOf(n,r);let i=t.substring(r+2,e).split(" ");if(0===(s+=this.T(i[0])))return r;e+=2}throw new Error("can't find end.")}render(t){t.u={};let r=h;for(let e=0;e<this.g.length;e++)r+=this.g[e].render(t);return r}}module.exports=p})();