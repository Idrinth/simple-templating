"use strict";(t=>{const e="undefined",r="object",n="each",s="if",i="{%",o="%}",h="",u=".",f={key:"key",value:"value",position:"pos",t:"even"};class l{constructor(t){this.s=t,this.i=t.split(u)}find(t){let r=t;for(let t of this.i){if(typeof r[t]===e)return h;r=r[t]}return r}o(t){return 1===this.i.length?t[this.s]:(typeof t.h[this.s]===e&&(t.h[this.s]=this.find(t)),t.h[this.s])}}class c extends l{constructor(t,e){let r="!"===t.charAt(0);super(r?t.substr(1):t),this.body=e,this.u=r}render(t){return!!this.o(t)===this.u?h:this.body.render(t)}}class a extends l{constructor(t,e){super(t),this.body=e,this.list=t,this.l="_"+t}clone(t){if(typeof t!==r||null===t)return t;if(t.constructor===Array){let e=new Array(t.length);for(let r=t.length-1;r>=0;r--)e[r]=this.clone(t[r]);return e}let e={};for(let r in t)e[r]=this.clone(t[r]);return e}p(t,e,r,n){let s={};s[f.key]=r,s[f.value]=e[r],s[f.position]=n,s[f.t]=!(n%2);for(let e in f)t.h[this.l+u+e]=s[e];return t[this.l]=s,this.body.render(t)}render(t){let e=this.o(t);if(!e)return h;if(typeof e!==r)return h;let n=h,s=this.clone(t);if(e.constructor===Array){for(let t=0;t<e.length;t++)n+=this.p(s,e,t,t);return n}let i=0;for(let t in e)n+=this.p(s,e,t,i),i++;return n}}class d extends l{constructor(t){super(t)}g(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}render(t){return(this.o(t)+h).replace(/[&<"'>]/g,this.g)}}class w{constructor(t){this.v=t}render(t){return this.v}}class p{constructor(t){if(this.m=[],"string"==typeof t&&t.length>0){let e=-1;for(;(e=t.indexOf("{{"))>-1;){e>0&&(this.m.push(new w(t.substr(0,e))),t=t.substr(e));let r=t.indexOf("}}"),n=t.substr(2,r-2);t=t.substr(r+2),this.m.push(new d(n))}this.m.push(new w(t))}}render(t){let e=h;for(let r of this.m)e+=r.render(t);return e}}class y{constructor(t){this.m=[];let e=0;for(;(e=t.indexOf(i))>-1;){e>0&&this.m.push(new p(t.substring(0,e)));let r=(t=t.substring(e+2)).indexOf(o),n=t.substring(0,r).split(" "),s=this.k(t,r+2);this.A(n[0],n[1],new y(t.substring(r+2,s))),t=t.substring(s+7)}this.m.push(new p(t))}A(t,e,r){if(t===n)return this.m.push(new a(e,r));if(t===s)return this.m.push(new c(e,r));throw new Error("Token "+t+" is invalid.")}T(t){return t===n||t===s?1:-1}k(t,e){let r=e,n=1;for(;(e=t.indexOf(i,r))>-1;){r=t.indexOf(o,e);let s=t.substring(e+2,r).split(" ");if(0===(n+=this.T(s[0])))return e;r+=2}throw new Error("can't find end.")}render(t){t.h={};let e=h;for(let r=0;r<this.m.length;r++)e+=this.m[r].render(t);return e}}typeof module!==e&&typeof module.exports!==e?module.exports=y:"function"==typeof define&&define.j?define([],()=>y):(t=>{if(typeof self!==e)return self;if(typeof window!==e)return window;if(typeof global!==e)return global;if(typeof t!==e)return t;throw new Error("nothing to attach to found")})(t).Template=y})(this);