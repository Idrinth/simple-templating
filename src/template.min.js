"use strict";(()=>{const t="undefined",e="object",r="each",s="if",n="{%",i="%}",o="",h=".",l={key:"key",value:"value",position:"pos",t:"even"};class u{constructor(t){this.s=t,this.i=t.split(h)}find(e){let r=e;for(let e of this.i){if(typeof r[e]===t)return o;r=r[e]}return r}o(e){return 1===this.i.length?e[this.s]:(typeof e.h[this.s]===t&&(e.h[this.s]=this.find(e)),e.h[this.s])}}class f extends u{constructor(t,e){let r="!"===t.charAt(0);super(r?t.substr(1):t),this.body=e,this.l=r}render(t){return!!this.o(t)===this.l?o:this.body.render(t)}}class c extends u{constructor(t,e){super(t),this.body=e,this.list=t,this.u="_"+t}clone(t){if(typeof t!==e||null===t)return t;if(t.constructor===Array){let e=new Array(t.length);for(let r=t.length-1;r>=0;r--)e[r]=this.clone(t[r]);return e}let r={};for(let e in t)r[e]=this.clone(t[e]);return r}p(t,e,r,s){let n={};n[l.key]=r,n[l.value]=e[r],n[l.position]=s,n[l.t]=!(s%2);for(let e in l)t.h[this.u+h+e]=n[e];return t[this.u]=n,this.body.render(t)}render(t){let r=this.o(t);if(!r)return o;if(typeof r!==e)return o;let s=o,n=this.clone(t);if(r.constructor===Array){for(let t=0;t<r.length;t++)s+=this.p(n,r,t,t);return s}let i=0;for(let t in r)s+=this.p(n,r,t,i),i++;return s}}class a extends u{constructor(t){super(t)}g(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}render(t){return(this.o(t)+o).replace(/[&<"'>]/g,this.g)}}class d{constructor(t){this.v=t}render(t){return this.v}}class w{constructor(t){if(this.m=[],"string"==typeof t&&t.length>0){let e=-1;for(;(e=t.indexOf("{{"))>-1;){e>0&&(this.m.push(new d(t.substr(0,e))),t=t.substr(e));let r=t.indexOf("}}"),s=t.substr(2,r-2);t=t.substr(r+2),this.m.push(new a(s))}this.m.push(new d(t))}}render(t){let e=o;for(let r of this.m)e+=r.render(t);return e}}class p{constructor(t){this.m=[];let e=0;for(;(e=t.indexOf(n))>-1;){e>0&&this.m.push(new w(t.substring(0,e)));let r=(t=t.substring(e+2)).indexOf(i),s=t.substring(0,r).split(" "),n=this.k(t,r+2);this.A(s[0],s[1],new p(t.substring(r+2,n))),t=t.substring(n+7)}this.m.push(new w(t))}A(t,e,n){if(t===r)return this.m.push(new c(e,n));if(t===s)return this.m.push(new f(e,n));throw new Error("Token "+t+" is invalid.")}T(t){return t===r||t===s?1:-1}k(t,e){let r=e,s=1;for(;(e=t.indexOf(n,r))>-1;){r=t.indexOf(i,e);let n=t.substring(e+2,r).split(" ");if(0===(s+=this.T(n[0])))return e;r+=2}throw new Error("can't find end.")}render(t){t.h={};let e=o;for(let r=0;r<this.m.length;r++)e+=this.m[r].render(t);return e}}if(typeof module!==t&&typeof module.exports!==t)module.exports=p;else if("function"==typeof define&&define.j)define([],()=>p);else{if(!(self||window||global||this))throw new Error("nothing to attach to found");(self||window||global||this).Template=p}})();