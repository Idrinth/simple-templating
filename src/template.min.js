"use strict";(()=>{class t{constructor(t){this.t=t,this.s=t.split(".")}find(t){let e=t;for(let t of this.s){if(void 0===e[t])return"";e=e[t]}return e}i(t){return 1===this.s.length?t[this.t]:(void 0===t.o[this.t]&&(t.o[this.t]=this.find(t)),t.o[this.t])}}class e extends t{constructor(t,e){let r="!"===t.charAt(0);super(r?t.substr(1):t),this.body=e,this.h=r}render(t){return!!this.i(t)===this.h?"":this.body.render(t)}}class r extends t{constructor(t,e){super(t),this.body=e,this.list=t}clone(t){if("object"!=typeof t||null===t)return t;if(t.constructor===Array){let e=new Array(t.length);for(let r=t.length-1;r>=0;r--)e[r]=this.clone(t[r]);return e}let e={};for(let r in t)e[r]=this.clone(t[r]);return e}l(t,e,r,s){t["_"+this.list]={key:r,value:e[r],u:!(s%2),p:s};for(let e in t["_"+this.list])t.o["_"+this.list+"."+e]=t["_"+this.list][e];return this.body.render(t)}render(t){let e=this.i(t);if(!e)return"";if("object"!=typeof e)return"";let r="",s=this.clone(t);if(e.constructor===Array){for(let t=0;t<e.length;t++)r+=this.l(s,e,t,t);return r}let i=0;for(let t in e)r+=this.l(s,e,t,i),i++;return r}}class s extends t{constructor(t){super(t)}g(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}render(t){return(this.i(t)+"").replace(/[&<"'>]/g,this.g)}}class i{constructor(t){this.v=t}render(t){return this.v}}class n{constructor(t){if(this.m=[],"string"==typeof t&&t.length>0){let e=-1;for(;(e=t.indexOf("{{"))>-1;){e>0&&(this.m.push(new i(t.substr(0,e))),t=t.substr(e));let r=t.indexOf("}}"),n=t.substr(2,r-2);t=t.substr(r+2),this.m.push(new s(n))}this.m.push(new i(t))}}render(t){let e="";for(let r of this.m)e+=r.render(t);return e}}class o{constructor(t){this.m=[];let e=0;for(;(e=t.indexOf("{%"))>-1;){e>0&&this.m.push(new n(t.substring(0,e)));let r=(t=t.substring(e+2)).indexOf("%}"),s=t.substring(0,r).split(" "),i=this._(t,r+2);this.j(s[0],s[1],new o(t.substring(r+2,i))),t=t.substring(i+7)}this.m.push(new n(t))}j(t,s,i){if("each"===t)return this.m.push(new r(s,i));if("if"===t)return this.m.push(new e(s,i));throw new Error("Token "+t+" is invalid.")}A(t){return"each"===t||"if"===t?1:-1}_(t,e){let r=e,s=1;for(;(e=t.indexOf("{%",r))>-1;){r=t.indexOf("%}",e);let i=t.substring(e+2,r).split(" ");if(0===(s+=this.A(i[0])))return e;r+=2}throw new Error("can't find end.")}render(t){t.o={};let e="";for(let r=0;r<this.m.length;r++)e+=this.m[r].render(t);return e}}if("undefined"!=typeof module&&void 0!==module.exports)module.exports=o;else if("function"==typeof define&&define.T)define([],()=>o);else{if(!(self||window||global||this))throw new Error("nothing to attach to found");(self||window||global||this).Template=o}})();