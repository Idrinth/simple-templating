"use strict";(t=>{const e="undefined",r="object",n="each",s="if",i="{%",o="%}",h="",u=".",l={key:"key",value:"value",position:"pos",t:"even"};class f{constructor(t){this.s=t,this.i=t.split(u)}find(t){let r=t;for(let t of this.i){if(typeof r[t]===e)return h;r=r[t]}return r}o(t){return 1===this.i.length?t[this.s]:(typeof t.h[this.s]===e&&(t.h[this.s]=this.find(t)),t.h[this.s])}}class c extends f{constructor(t,e){let r="!"===t.charAt(0);super(r?t.substr(1):t),this.body=e,this.u=r}render(t){return!!this.o(t)===this.u?h:this.body.render(t)}}class a extends f{constructor(t,e){super(t),this.body=e,this.list=t,this.l="_"+t.replace(u,"#")}p(t){let e=new Array(t.length);for(let r=t.length-1;r>=0;r--)e[r]=this.clone(t[r]);return e}g(t){let e={};for(let r in t)e[r]=this.clone(t[r]);return e}clone(t){return typeof t!==r||null===t?t:t.constructor===Array?this.p(t):this.g(t)}v(t,e,r,n){let s={};s[l.key]=r,s[l.value]=e[r],s[l.position]=n,s[l.t]=!(n%2);for(let e in l)t.h[this.l+u+e]=s[e];return t[this.l]=s,this.body.render(t)}render(t){let e=this.o(t);if(!e)return h;if(typeof e!==r)return h;let n=[e,this.clone(t),h];return e.constructor===Array&&this.m(...n),this.A(...n)}m(t,e,r){for(let n=0;n<t.length;n++)r+=this.v(e,t,n,n);return r}A(t,e,r){let n=0;for(let s in t)r+=this.v(e,t,s,n),n++;return r}}class d extends f{j(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}render(t){return(this.o(t)+h).replace(/[&<"'>]/g,this.j)}}class w{constructor(t){this.T=t}render(t){return this.T}}class y{constructor(t){this.k=this.P(t)}P(t){if(!t||"string"!=typeof t)return[];let e=[],r=-1;for(;(r=t.indexOf("{{"))>-1;){r>0&&(e.push(new w(t.substr(0,r))),t=t.substr(r));let n=t.indexOf("}}"),s=t.substr(2,n-2);t=t.substr(n+2),e.push(new d(s))}return e.push(new w(t)),e}render(t){let e=h;for(let r of this.k)e+=r.render(t);return e}}class p{constructor(t){this.k=[];let e=0;for(;(e=t.indexOf(i))>-1;){e>0&&this.k.push(new y(t.substring(0,e)));let r=(t=t.substring(e+2)).indexOf(o),n=t.substring(0,r).split(" "),s=this.O(t,r+2);this.q(n[0],n[1],new p(t.substring(r+2,s))),t=t.substring(s+7)}this.k.push(new y(t))}q(t,e,r){if(t===n)return this.k.push(new a(e,r));if(t===s)return this.k.push(new c(e,r));throw new Error("Token "+t+" is invalid.")}F(t){return t===n||t===s?1:-1}O(t,e){let r=e,n=1;for(;(e=t.indexOf(i,r))>-1;){r=t.indexOf(o,e);let s=t.substring(e+2,r).split(" ");if(0===(n+=this.F(s[0])))return e;r+=2}throw new Error("can't find end.")}render(t){t.h={};let e=h;for(let r=0;r<this.k.length;r++)e+=this.k[r].render(t);return e}}typeof module!==e&&typeof module.exports!==e?module.exports=p:"function"==typeof define&&define.M?define([],()=>p):(t=>{if(typeof self!==e)return self;if(typeof window!==e)return window;if(typeof global!==e)return global;if(typeof t!==e)return t;throw new Error("nothing to attach to found")})(t).Template=p})(this);